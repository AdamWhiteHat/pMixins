using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace pMixins.Mvc.Recipes.Introduction.ExampleCodeBehind
{
    public class HelloWorld
    {
        public string SayHello()
        {
            return "Copy";
        }
    }

    public partial class Introduction
    {
        /// <summary>
        /// Container for all Generated Mixin Wrapper Class Definitions
        /// </summary>
        private sealed class __pMixinAutoGenerated
        {
            /// <summary>
            /// Container for Hello World Specific Wrappers
            /// </summary>
            public sealed class HelloWorldMixin
            {
                /// <summary>
                /// Promote Protected Members to Public.  pMixins will enforce
                /// access restrictions.
                /// </summary>
                public abstract class HelloWorldProtectedMembersWrapper : HelloWorld { }

                /// <summary>
                /// Satisfies any abstract member requirements by proxying to 
                /// Target.
                /// </summary>
                public class HelloWorldAbstractWrapper : HelloWorldProtectedMembersWrapper
                {
                    private readonly Introduction _target;

                    public HelloWorldAbstractWrapper(Introduction target)
                    {
                        _target = target;
                    }
                }

                public sealed class HelloWorldMasterWrapper : CopaceticSoftware.pMixins.Infrastructure.MasterWrapperBase
                {
                    public readonly HelloWorld _mixinInstance;

                    public HelloWorldMasterWrapper(Introduction _target)
                    {
                        _mixinInstance = base.TryActivateMixin<HelloWorldAbstractWrapper>(_target);

                        base.Initialize(_target, _mixinInstance, new List<CopaceticSoftware.pMixins.Interceptors.IMixinInterceptor>());
                    }


                    internal string SayHello()
                    {
                        var methodName = "SayHello";
                        var parameters = new List<CopaceticSoftware.pMixins.Interceptors.Parameter>();
                        Func<string> invocationDelegate = () => _mixinInstance.SayHello();

                        //Wire into AOP Infrastructure
                        return base.ExecuteMethod(
                            methodName,
                            parameters,
                            invocationDelegate);
                    }
                }
            }
        }

        /// <summary>
        /// Container for Mixin instances
        /// </summary>
        private sealed class __Mixins
		{
            //Instance of Hello World 
            public readonly __pMixinAutoGenerated.HelloWorldMixin.HelloWorldMasterWrapper _HelloWorld;

			public __Mixins (Introduction host)
			{
			    var activator =
			        CopaceticSoftware.pMixins.Infrastructure.MixinActivatorFactory.GetCurrentActivator();

				_HelloWorld = 
                    activator.CreateInstance<
                        __pMixinAutoGenerated.HelloWorldMixin.HelloWorldMasterWrapper>(host);
			}
		}

        private __Mixins ___mixinsBacking;
        private __Mixins __mixins
        {
            get { return ___mixinsBacking ?? (___mixinsBacking = new __Mixins(this)); }
        }

        /// <summary>
        /// Mixed in from HelloWorld.SayHello()
        /// </summary>
        public string SayHello()
        {
            return __mixins._HelloWorld.SayHello();
        }
    }
}
